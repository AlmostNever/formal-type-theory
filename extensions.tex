\section{Extensions of the Theory}
\label{sec:extensions}

In this section we take a look in different extensions that we could add to
our theory without having to go through the sanity theorem all over again.
Remark that without these extensions our type theory would remain empty as there
are no base types.

The way we proceed is simple, if we add elements of syntax and rules, we don't
have to redo the proof entirely, we only have to deal with the new cases it
brings in the induction as well as reproving all inversion lemmata
(this explains why we are so careful in not using inversion inside the sanity
proof without explicitely refering to it as an external lemma).

\subsection{Empty Type}
\label{sec:empty-type}

We extend the syntax with the following:
%
\begin{align*}
  \text{Type $\A$, $\B$, $\C$}
    \bnf   {}& \ldots                   && \text{previous types}\\
    \bnfor {}& \Empty                   && \text{empty type} \\
  \\
  \text{Term $\uu$, $\vv$, $\ww$}
    \bnf   {}& \ldots                   && \text{previous terms} \\
    \bnfor {}& \exfalso{\A} \uu         && \text{ex falso quod libet}
\end{align*}

We now lay the new rules.

\newcommand{\rlTyEmpty}{\referTo{ty-empty}{rul:ty-empty}}
\newcommand{\showTyEmpty}{%
  \infer[\rulename{ty-empty}] % TyEmpty
  {\isctx{\G}}
  {\istype{\G}{\Empty}}
}

\newcommand{\rlTermExfalso}{\referTo{term-exfalso}{rul:term-exfalso}}
\newcommand{\showTermExfalso}{%
  \infer[\rulename{term-exfalso}] % TermExfalso
  {\istype{\G}{\A} \\
   \isterm{\G}{\uu}{\Empty}
  }
  {\isterm{\G}{\exfalso{\A} \uu}{\A}}
}

\newcommand{\rlEqTySubstEmpty}{\referTo{eq-ty-subst-empty}{rul:eq-ty-subst-empty}}
\newcommand{\showEqTySubstEmpty}{%
  \infer[\rulename{eq-ty-subst-empty}] % EqTySubstEmpty
  {\issubst{\sbs}{\G}{\D}}
  {\eqtype{\G}{\subst{\Empty}{\sbs}}{\Empty}}
}

\newcommand{\rlEqSubstExfalso}{\referTo{eq-subst-exfalso}{rul:eq-subst-exfalso}}
\newcommand{\showEqSubstExfalso}{%
  \infer[\rulename{eq-subst-exfalso}] % EqSubstExfalso
  {\issubst{\sbs}{\G}{\D} \\
   \istype{\D}{\A} \\
   \isterm{\D}{\uu}{\Empty}
  }
  {\eqterm{\G}
    {\subst{(\exfalso{\A} \uu)}{\sbs}}
    {\exfalso{\subst{\A}{\sbs}} \subst{\uu}{\sbs}}
    {\subst{\A}{\sbs}}
  }
}

\newcommand{\rlConfExfalso}{\referTo{cong-exfalso}{rul:cong-exfalso}}
\newcommand{\showConfExfalso}{%
  \infer[\rulename{cong-exfalso}] % ConfExfalso
  {\eqtype{\G}{\A}{\B} \\
   \eqterm{\G}{\uu}{\vv}{\Empty}
  }
  {\eqterm{\G}
    {\exfalso{\A} \uu}
    {\exfalso{\B} \vv}
    {\A}
  }
}

\begin{mathpar}
  {\label{rul:ty-empty} \showTyEmpty}

  {\label{rul:term-exfalso} \showTermExfalso}

  {\label{rul:eq-ty-subst-empty} \showEqTySubstEmpty}

  {\label{rul:eq-subst-exfalso} \showEqSubstExfalso}

  {\label{rul:cong-exfalso} \showConfExfalso}
\end{mathpar}

First notice that the inversion lemma~\ref{pbm:id-inversion} still holds with
the same proof as none of the rules we introduce can yield
$\istype{\G}{\Id{\A}{\uu}{\vv}}$.
Now let's extend the proof of sanity~\ref{pbm:sanity}.

\subsubsection*{Rule {\rlTyEmpty}}

Consider a derivation ending with
%
\begin{equation*}
  \showTyEmpty
\end{equation*}
%
We have $\isctx{\G}$ as a premise.


\subsubsection*{Rule {\rlTermExfalso}}

Consider a derivation ending with
%
\begin{equation*}
  \showTermExfalso
\end{equation*}
%
We have $\isctx{\G}$ by induction hypothesis and $\istype{\G}{\A}$ as a premise.


\subsubsection*{Rule {\rlEqTySubstEmpty}}

Consider a derivation ending with
%
\begin{equation*}
  \showEqTySubstEmpty
\end{equation*}
%
We have $\isctx{\G}$ and $\isctx{\D}$ by induction hypothesis.
Using {\rlTyEmpty} we derive $\istype{\G}{\Empty}$ and $\istype{\D}{\Empty}$,
then using {\rlTySubst} we conclude $\istype{\G}{\subst{\Empty}{\sbs}}$.


\subsubsection*{Rule {\rlEqSubstExfalso}}

Consider a derivation ending with
%
\begin{equation*}
  \showEqSubstExfalso
\end{equation*}
%
By induction hypothesis on the left premise we get $\isctx{\G}$.
Using {\rlTySubst} we get $\istype{\G}{\subst{\A}{\sbs}}$.
Using {\rlTermExfalso} we derive $\isterm{\D}{\exfalso{\A} \uu}{\A}$
and then with {\rlTermSubst} we conclude
$\isterm{\G}{\subst{(\exfalso{\A} \uu)}{\sbs}}{\subst{\A}{\sbs}}$.
Using {\rlTermSubst} and then {\rlTermExfalso} yields
$\isterm{\G}{\exfalso{\subst{\A}{\sbs}} \subst{\uu}{\sbs}}{\subst{\A}{\sbs}}$.


\subsubsection*{Rule {\rlConfExfalso}}

Consider a derivation ending with
%
\begin{equation*}
  \showConfExfalso
\end{equation*}
%
By induction hypothesis on the left premise $\isctx{\G}$ and $\istype{\G}{\A}$
and $\istype{\G}{\B}$.
Induction hypothesis on the right premise yields $\isterm{\G}{\uu}{\Empty}$
and $\isterm{\G}{\vv}{\Empty}$.
Applications of {\rlTermExfalso} give $\isterm{\G}{\exfalso{\A} \uu}{\A}$
and $\isterm{\G}{\exfalso{\B} \vv}{\B}$.
We conclude $\isterm{\G}{\exfalso{\B} \vv}{\A}$ with {\rlEqTySym} and
{\rlTermTyConv}.


\subsection{Unit Type}
\label{sec:unit-type}

\begin{align*}
  \text{Type $\A$, $\B$, $\C$}
    \bnf   {}& \ldots                   && \text{previous types}\\
    \bnfor {}& \Unit                    && \text{unit type} \\
  \\
  \text{Term $\uu$, $\vv$, $\ww$}
    \bnf   {}& \ldots                   && \text{previous terms} \\
    \bnfor {}& \unit                    && \text{the unit inhabitant} \\
    \bnfor {}& \ulet{\A}{\uu} \vv       && \text{the unit eliminator}
\end{align*}

\newcommand{\rlTyUnit}{\referTo{ty-unit}{rul:ty-unit}}
\newcommand{\showTyUnit}{%
  \infer[\rulename{ty-unit}] % TyUnit
  {\isctx{\G}}
  {\istype{\G}{\Unit}}
}

\newcommand{\rlTermUnit}{\referTo{term-unit}{rul:term-unit}}
\newcommand{\showTermUnit}{%
  \infer[\rulename{term-unit}] % TermUnit
  {\isctx{\G}}
  {\isterm{\G}{\unit}{\Unit}}
}

\newcommand{\rlTermLet}{\referTo{term-let}{rul:term-let}}
\newcommand{\showTermLet}{%
  \infer[\rulename{term-let}] % TermLet
  {\istype{\ctxextend{\G}{\Unit}}{\A} \\
   \isterm{\G}{\uu}{\Unit} \\
   \isterm{\G}{\vv}{\subst{\A}{\sbzero{\G}{\Unit}{\unit}}}}
  {\isterm{\G}{\ulet{\A}{\uu} \vv}{\subst{\A}{\sbzero{\G}{\Unit}{\uu}}}}
}

\newcommand{\rlEqTySubstUnit}{\referTo{eq-ty-subst-unit}{rul:eq-ty-subst-unit}}
\newcommand{\showEqTySubstUnit}{%
  \infer[\rulename{eq-ty-subst-unit}] % EqTySubstUnit
  {\issubst{\sbs}{\G}{\D}}
  {\eqtype{\G}{\subst{\Unit}{\sbs}}{\Unit}}
}

\newcommand{\rlEqSubstUnit}{\referTo{eq-subst-unit}{rul:eq-subst-unit}}
\newcommand{\showEqSubstUnit}{%
  \infer[\rulename{eq-subst-unit}] % EqSubstUnit
  {\issubst{\sbs}{\G}{\D}}
  {\eqterm{\G}{\subst{\unit}{\sbs}}{\unit}{\Unit}}
}

\newcommand{\rlEqSubstLet}{\referTo{eq-subst-let}{rul:eq-subst-let}}
\newcommand{\showEqSubstLet}{%
  \infer[\rulename{eq-subst-let}] % EqSubstLet
  {\issubst{\sbs}{\G}{\D} \\
   \istype{\ctxextend{\D}{\Unit}}{\A} \\
   \isterm{\D}{\uu}{\Unit} \\
   \isterm{\D}{\vv}{\subst{\A}{\sbzero{\D}{\Unit}{\unit}}}}
  {\eqterm{\G}
    {\subst{(\ulet{\A}{\uu} \vv)}{\sbs}}
    {\ulet
      {\subst{\A}{\sbshift{\G}{\Unit}{\sbs}}}
      {\subst{\uu}{\sbs}}
      \subst{\vv}{\sbs}
    }
    {\subst{\subst{\A}{\sbzero{\D}{\Unit}{\uu}}}}{\sbs}}
}

\newcommand{\rlLetBeta}{\referTo{let-beta}{rul:let-beta}}
\newcommand{\showLetBeta}{%
  \infer[\rulename{let-beta}] % LetBeta
  {\istype{\ctxextend{\G}{\Unit}}{\A} \\
   \isterm{\G}{\vv}{\subst{\A}{\sbzero{\G}{\Unit}{\unit}}}}
  {\eqterm{\G}
    {\ulet{\A}{\unit} \vv}
    {\vv}
    {\subst{\A}{\sbzero{\G}{\Unit}{\unit}}}}
}

\newcommand{\rlCongLet}{\referTo{cong-let}{rul:cong-let}}
\newcommand{\showCongLet}{%
  \infer[\rulename{cong-let}] % CongLet
  {\eqtype{\ctxextend{\G}{\Unit}}{\A}{\B} \\
   \eqterm{\G}{\uu_1}{\uu_2}{\Unit} \\
   \eqterm{\G}{\vv_1}{\vv_2}{\subst{\A}{\sbzero{\G}{\Unit}{\unit}}}}
  {\eqterm{\G}
    {\ulet{\A}{\uu_1} \vv_1}
    {\ulet{\B}{\uu_2} \vv_2}
    {\subst{\A}{\sbzero{\G}{\Unit}{\uu_1}}}}
}

\begin{mathpar}
  {\label{rul:ty-unit} \showTyUnit}

  {\label{rul:term-unit} \showTermUnit}

  {\label{rul:term-let} \showTermLet}

  {\label{rul:eq-ty-subst-unit} \showEqTySubstUnit}

  {\label{rul:eq-subst-unit} \showEqSubstUnit}

  {\label{rul:eq-subst-let} \showEqSubstLet}

  {\label{rul:let-beta} \showLetBeta}

  {\label{rul:cong-let} \showCongLet}
\end{mathpar}

Remark: None of the rules can be used to conclude
$\istype{\G}{\Id{\A}{\uu}{\vv}}$ and so lemma~\ref{pbm:id-inversion} still
holds with this extension.

\subsubsection*{Rule {\rlTyUnit}}

Consider a derivation ending with
%
\begin{equation*}
  \showTyUnit
\end{equation*}
%
We have $\isctx{\G}$ as a premise.

\subsubsection*{Rule {\rlTermUnit}}

Consider a derivation ending with
%
\begin{equation*}
  \showTermUnit
\end{equation*}
%
We have $\isctx{\G}$ as a premise and from it and {\rlTyUnit} we conclude
$\istype{\G}{\Unit}$.

\subsubsection*{Rule {\rlTermLet}}

Consider a derivation ending with
%
\begin{equation*}
  \showTermLet
\end{equation*}
%
We have $\isctx{\G}$ by induction hypothesis on the middle premise.
With an application of {\rlSubstZero} to the middle premise we get
$\issubst{\sbzero{\G}{\Unit}{\uu}}{\G}{\ctxextend{\G}{\Unit}}$.
With {\rlTySubst} we conclude
$\istype{\G}{\subst{\A}{\sbzero{\G}{\Unit}{\uu}}}$.

\subsubsection*{Rule {\rlEqTySubstUnit}}

Consider a derivation ending with
%
\begin{equation*}
  \showEqTySubstUnit
\end{equation*}
%
By induction hypothesis we have $\isctx{\G}$ and $\isctx{\D}$.
Then with {\rlTyUnit} we get $\istype{\G}{\Unit}$ and $\istype{\D}{\Unit}$.
With {\rlTySubst} we finally conclude $\istype{\G}{\subst{\Unit}{\sbs}}$.

\subsubsection*{Rule {\rlEqSubstUnit}}

Consider a derivation ending with
%
\begin{equation*}
  \showEqSubstUnit
\end{equation*}
%
By induction hypothesis $\isctx{\G}$ and $\isctx{\D}$.
Then using {\rlTyUnit} we conclude $\istype{\G}{\Unit}$.
Applications of {\rlTermUnit} yield $\isterm{\G}{\unit}{\Unit}$
and $\isterm{\D}{\unit}{\Unit}$.
With {\rlTermSubst} we get
$\isterm{\G}{\subst{\unit}{\sbs}}{\subst{\Unit}{\sbs}}$.
Finally using {\rlEqTySubstUnit} and {\rlTermTyConv} we conclude
$\isterm{\G}{\subst{\unit}{\sbs}}{\Unit}$.

\subsubsection*{Rule {\rlEqSubstLet}}

Consider a derivation ending with
%
\begin{equation*}
  \showEqSubstLet
\end{equation*}
%
By induction hypothesis on the left premise we have $\isctx{\G}$.
From {\rlSubstZero} we deduce
$\issubst{\sbzero{\D}{\Unit}{\uu}}{\D}{\ctxextend{\D}{\Unit}}$ and thus,
with two applications of {\rlTySubst} we derive
$\istype{\G}{\subst{\subst{\A}{\sbzero{\D}{\Unit}{\uu}}}{\sbs}}$.
An application of {\rlTermLet} followed by {\rlTermSubst} gives us
$\isterm{\G}
  {\subst{(\ulet{\A}{\uu} \vv)}{\sbs}}
  {\subst{\subst{\A}{\sbzero{\D}{\Unit}{\uu}}}{\sbs}}
$.
%
Applications of {\rlTermSubst} yield
$\isterm{\G}{\subst{\uu}{\sbs}}{\subst{\Unit}{\sbs}}$ and
$\isterm{\G}
  {\subst{\vv}{\sbs}}
  {\subst{\subst{\A}{\sbzero{\D}{\Unit}{\unit}}}{\sbs}}
$.
With {\rlEqSubstUnit} and {\rlTermTyConv} we get
$\isterm{\G}{\subst{\uu}{\sbs}}{\Unit}$.
Now, using {\rlEqTyShiftZero}, {\rlEqTySym}
we get to the type
$\subst
  {\subst{\A}{\sbshift{\G}{\Unit}{\sbs}}}
  {\sbzero{\G}{\subst{\Unit}{\sbs}}{\subst{\unit}{\sbs}}}
$.
Then, if we use {\rlEqTyTrans} with a right hand side obtained through
{\rlEqTyCongZero}, {\rlEqSubstUnit}, {\rlEqTySubstUnit}, and finally
{\rlTermTyConv} we get
$\isterm{\G}
  {\subst{\vv}{\sbs}}
  {\subst
    {\subst{\A}{\sbshift{\G}{\Unit}{\sbs}}}
    {\sbzero{\G}{\Unit}{\unit}}
  }
$.
Then, by applying {\rlSubstShift} and {\rlTySubst} and then {\rlEqTySubstUnit}
followed by {\rlEqCtxExtend} we get
$\istype{\ctxextend{\G}{\Unit}}{\subst{\A}{\sbshift{\G}{\Unit}{\sbs}}}$.
Now, using {\rlTermLet} we get
$\isterm{\G}
  {\ulet
    {\subst{\A}{\sbshift{\G}{\Unit}{\sbs}}}
    {\subst{\uu}{\sbs}}
    \subst{\vv}{\sbs}}
  {\subst
    {\subst{\A}{\sbshift{\G}{\Unit}{\sbs}}}
    {\sbzero{\G}{\Unit}{\subst{\uu}{\sbs}}}
  }
$.
By an application of {\rlEqTyCongZero} and {\rlEqTySubstUnit} we equate
$\subst
  {\subst{\A}{\sbshift{\G}{\Unit}{\sbs}}}
  {\sbzero{\G}{\Unit}{\subst{\uu}{\sbs}}}
$ and
$\subst
  {\subst{\A}{\sbshift{\G}{\Unit}{\sbs}}}
  {\sbzero{\G}{\subst{\Unit}{\sbs}}{\subst{\uu}{\sbs}}}
$.
From this, we apply {\rlEqTyTrans} and {\rlEqTyShiftZero} to equate this with
the type
$\subst
  {\subst{\A}{\sbzero{\D}{\Unit}{\uu}}}
  {\sbs}
$.
Now, by applying {\rlTermTyConv} we can finally conclude that
$\isterm{\G}
  {\ulet
    {\subst{\A}{\sbshift{\G}{\Unit}{\sbs}}}
    {\subst{\uu}{\sbs}}
    \subst{\vv}{\sbs}}
  {\subst
    {\subst{\A}{\sbzero{\D}{\Unit}{\uu}}}
    {\sbs}
  }
$.


\subsubsection*{Rule {\rlLetBeta}}

Consider a derivation ending with
%
\begin{equation*}
  \showLetBeta
\end{equation*}
%
By indcution hypothesis on the right premise we conclude $\isctx{\G}$
and $\istype{\G}{\subst{\A}{\sbzero{\G}{\Unit}{\unit}}}$.
We have $\isterm{\G}{\vv}{\subst{\A}{\sbzero{\G}{\Unit}{\unit}}}$ as a
premise.
Now, knowing $\isterm{\G}{\unit}{\Unit}$ we have, by {\rlTermLet},
$\isterm{\G}{\ulet{\A}{\unit} \vv}{\subst{\A}{\sbzero{\G}{\Unit}{\unit}}}$.

\subsubsection*{Rule {\rlCongLet}}

Consider a derivation ending with
%
\begin{equation*}
  \showCongLet
\end{equation*}
%
By induction hypothesis on the middle premise we have $\isctx{\G}$
and $\isterm{\G}{\uu_1}{\Unit}$.
%
By {\rlSubstZero} we deduce
$\issubst{\sbzero{\G}{\Unit}{\uu_1}}{\G}{\ctxextend{\G}{\Unit}}$.
Since by induction hypothesis on the left premise we have
$\istype{\ctxextend{\G}{\Unit}}{\A}$ we conclude
$\istype{\G}{\subst{\A}{\sbzero{\G}{\Unit}{\uu_1}}}$.
%
By induction hypothesis on the different premises we have
$\istype{\ctxextend{\G}{\Unit}}{\A}$,
$\isterm{\G}{\uu_1}{\Unit}$ and
$\isterm{\G}{\vv_1}{\subst{\A}{\sbzero{\G}{\Unit}{\unit}}}$,
and so by {\rlTermLet} we conclude
$\isterm{\G}{\ulet{\A}{\uu_1} \vv_1}{\subst{\A}{\sbzero{\G}{\Unit}{\uu_1}}}$.
%
On the other hand, induction hypothesis, followed by {\rlCongTySubst} and
{\rlTermTyConv} we have
$\istype{\ctxextend{\G}{\Unit}}{\B}$,
$\isterm{\G}{\uu_2}{\Unit}$ and
$\isterm{\G}{\vv_2}{\subst{\B}{\sbzero{\G}{\Unit}{\unit}}}$,
and with an application of {\rlTermLet} so we can derive
$\isterm{\G}{\ulet{\B}{\uu_2} \vv_2}{\subst{\B}{\sbzero{\G}{\Unit}{\uu_2}}}$.
Now thanks to {\rlTermTyConv} and {\rlEqTySym} it suffices to prove
$\eqtype{\G}
  {\subst{\A}{\sbzero{\G}{\Unit}{\uu_1}}}
  {\subst{\B}{\sbzero{\G}{\Unit}{\uu_2}}}
$.
This is achived by {\rlEqTyTrans} using {\rlCongTySubst} on one side and
{\rlEqTyCongZero} on the other.

\subsection{Boolean Type}
\label{sec:bool-type}

\begin{align*}
  \text{Type $\A$, $\B$, $\C$}
    \bnf   {}& \ldots                   && \text{previous types}\\
    \bnfor {}& \Bool                    && \text{bool type} \\
    \bnfor {}& \Cond{\uu}{\A}{\B}       && \text{conditional type} \\
  \\
  \text{Term $\uu$, $\vv$, $\ww$}
    \bnf   {}& \ldots                   && \text{previous terms} \\
    \bnfor {}& \true                    && \text{true} \\
    \bnfor {}& \false                   && \text{false} \\
    \bnfor {}& \cond{\A}{\uu}{\vv}{\ww} && \text{conditional term}
\end{align*}

\newcommand{\rlTyBool}{\referTo{ty-bool}{rul:ty-bool}}
\newcommand{\showTyBool}{%
  \infer[\rulename{ty-bool}] % TyBool
  {\isctx{\G}}
  {\istype{\G}{\Bool}}
}

\newcommand{\rlTyCond}{\referTo{ty-cond}{rul:ty-cond}}
\newcommand{\showTyCond}{%
  \infer[\rulename{ty-cond}] % TyCond
  {\isterm{\G}{\uu}{\Bool} \\
   \istype{\G}{\A} \\
   \istype{\G}{\B}
  }
  {\istype{\G}{\Cond{\uu}{\A}{\B}}}
}

\newcommand{\rlTermTrue}{\referTo{term-true}{rul:term-true}}
\newcommand{\showTermTrue}{%
  \infer[\rulename{term-true}] % TermTrue
  {\isctx{\G}}
  {\isterm{\G}{\true}{\Bool}}
}

\newcommand{\rlTermFalse}{\referTo{term-false}{rul:term-false}}
\newcommand{\showTermFalse}{%
  \infer[\rulename{term-false}] % TermFalse
  {\isctx{\G}}
  {\isterm{\G}{\false}{\Bool}}
}

\newcommand{\rlTermCond}{\referTo{term-cond}{rul:term-cond}}
\newcommand{\showTermCond}{%
  \infer[\rulename{term-cond}] % TermCond
  {\isterm{\G}{\uu}{\Bool} \\
   \istype{\ctxextend{\G}{\Bool}}{\C} \\
   \isterm{\G}{\vv}{\subst{\C}{\sbzero{\G}{\Bool}{\true}}} \\
   \isterm{\G}{\ww}{\subst{\C}{\sbzero{\G}{\Bool}{\false}}}
  }
  {\isterm{\G}{\cond{\C}{\uu}{\vv}{\ww}}{\subst{\C}{\sbzero{\G}{\Bool}{\uu}}}}
}

\newcommand{\rlEqTySubstBool}{\referTo{eq-ty-subst-bool}{rul:eq-ty-subst-bool}}
\newcommand{\showEqTySubstBool}{%
  \infer[\rulename{eq-ty-subst-bool}] % EqTySubstBool
  {\issubst{\sbs}{\G}{\D}}
  {\eqtype{\G}{\subst{\Bool}{\sbs}}{\Bool}}
}

\newcommand{\rlEqTySubstCond}{\referTo{eq-ty-subst-cond}{rul:eq-ty-subst-cond}}
\newcommand{\showEqTySubstCond}{%
  \infer[\rulename{eq-ty-subst-cond}] % EqTySubstCond
  {\issubst{\sbs}{\G}{\D} \\
   \isterm{\D}{\uu}{\Bool} \\
   \istype{\D}{\A} \\
   \istype{\D}{\B}
  }
  {\eqtype{\G}
    {\subst{\Cond{\uu}{\A}{\B}}{\sbs}}
    {\Cond{\subst{\uu}{\sbs}}{\subst{\A}{\sbs}}{\subst{\B}{\sbs}}}}
}

\newcommand{\rlEqSubstTrue}{\referTo{eq-subst-true}{rul:eq-subst-true}}
\newcommand{\showEqSubstTrue}{%
  \infer[\rulename{eq-subst-true}] % EqSubstTrue
  {\issubst{\sbs}{\G}{\D}}
  {\eqterm{\G}{\subst{\true}{\sbs}}{\true}{\Bool}}
}

\newcommand{\rlEqSubstFalse}{\referTo{eq-subst-false}{rul:eq-subst-false}}
\newcommand{\showEqSubstFalse}{%
  \infer[\rulename{eq-subst-false}] % EqSubstFalse
  {\issubst{\sbs}{\G}{\D}}
  {\eqterm{\G}{\subst{\false}{\sbs}}{\false}{\Bool}}
}

\newcommand{\rlEqSubstCond}{\referTo{eq-subst-cond}{rul:eq-subst-cond}}
\newcommand{\showEqSubstCond}{%
  \infer[\rulename{eq-subst-cond}] % EqSubstCond
  {\issubst{\sbs}{\G}{\D} \\
   \isterm{\D}{\uu}{\Bool} \\
   \istype{\ctxextend{\D}{\Bool}}{\C} \\
   \isterm{\D}{\vv}{\subst{\C}{\sbzero{\D}{\Bool}{\true}}} \\
   \isterm{\D}{\ww}{\subst{\C}{\sbzero{\D}{\Bool}{\false}}}
  }
  {\eqterm{\G}
    {\subst{\cond{\C}{\uu}{\vv}{\ww}}{\sbs}}
    {\cond
      {\subst{\C}{\sbshift{\G}{\Bool}{\sbs}}}
      {\subst{\uu}{\sbs}}
      {\subst{\vv}{\sbs}}
      {\subst{\ww}{\sbs}}
    }
    {\subst{\C}{\sbzero{\G}{\Bool}{\uu}}}
  }
}

\newcommand{\rlLargeCondTrue}{\referTo{large-cond-true}{rul:large-cond-true}}
\newcommand{\showLargeCondTrue}{%
  \infer[\rulename{large-cond-true}] % LargeCondTrue
  {\istype{\G}{\A} \\
   \istype{\G}{\B}
  }
  {\eqtype{\G}{\Cond{\true}{\A}{\B}}{\A}}
}

\newcommand{\rlLargeCondFalse}{\referTo{large-cond-false}{rul:large-cond-false}}
\newcommand{\showLargeCondFalse}{%
  \infer[\rulename{large-cond-false}] % LargeCondFalse
  {\istype{\G}{\A} \\
   \istype{\G}{\B}
  }
  {\eqtype{\G}{\Cond{\false}{\A}{\B}}{\B}}
}

\newcommand{\rlCondTrue}{\referTo{cond-true}{rul:cond-true}}
\newcommand{\showCondTrue}{%
  \infer[\rulename{cond-true}] % CondTrue
  {\istype{\ctxextend{\G}{\Bool}}{\C} \\
   \isterm{\G}{\vv}{\subst{\C}{\sbzero{\G}{\Bool}{\true}}} \\
   \isterm{\G}{\ww}{\subst{\C}{\sbzero{\G}{\Bool}{\false}}}
  }
  {\eqterm{\G}
    {\cond{\C}{\true}{\vv}{\ww}}
    {\vv}
    {\subst{\C}{\sbzero{\G}{\Bool}{\true}}}
  }
}

\newcommand{\rlCondFalse}{\referTo{cond-false}{rul:cond-false}}
\newcommand{\showCondFalse}{%
  \infer[\rulename{cond-false}] % CondFalse
  {\istype{\ctxextend{\G}{\Bool}}{\C} \\
   \isterm{\G}{\vv}{\subst{\C}{\sbzero{\G}{\Bool}{\true}}} \\
   \isterm{\G}{\ww}{\subst{\C}{\sbzero{\G}{\Bool}{\false}}}
  }
  {\eqterm{\G}
    {\cond{\C}{\false}{\vv}{\ww}}
    {\ww}
    {\subst{\C}{\sbzero{\G}{\Bool}{\false}}}
  }
}

\newcommand{\rlCongLargeCond}{\referTo{cong-large-cond}{rul:cong-large-cond}}
\newcommand{\showCongLargeCond}{%
  \infer[\rulename{cong-large-cond}] % CongLargeCond
  {\eqterm{\G}{\uu_1}{\uu_2}{\Bool} \\
   \eqtype{\G}{\A_1}{\A_2} \\
   \eqtype{\G}{\B_1}{\B_2}
  }
  {\eqtype{\G}{\Cond{\uu_1}{\A_1}{\B_1}}{\Cond{\uu_2}{\A_2}{\B_2}}}
}

\newcommand{\rlCongCond}{\referTo{cong-cond}{rul:cong-cond}}
\newcommand{\showCongCond}{%
  \infer[\rulename{cong-cond}] % CongCond
  {\eqterm{\G}{\uu_1}{\uu_2}{\Bool} \\
   \eqtype{\ctxextend{\G}{\Bool}}{\C_1}{\C_2} \\
   \eqterm{\G}{\vv_1}{\vv_2}{\subst{\C_1}{\sbzero{\G}{\Bool}{\true}}} \\
   \eqterm{\G}{\ww_1}{\ww_2}{\subst{\C_1}{\sbzero{\G}{\Bool}{\false}}}
  }
  {\eqterm{\G}
    {\cond{\C_1}{\uu_1}{\vv_1}{\ww_1}}
    {\cond{\C_2}{\uu_2}{\vv_2}{\ww_2}}
    {\subst{\C_1}{\sbzero{\G}{\Bool}{\uu_1}}}}
}

\begin{mathpar}
  {\label{rul:ty-bool} \showTyBool}

  {\label{rul:ty-cond} \showTyCond}

  {\label{rul:term-true} \showTermTrue}

  {\label{rul:term-false} \showTermFalse}

  {\label{rul:term-cond} \showTermCond}

  {\label{rul:eq-ty-subst-bool} \showEqTySubstBool}

  {\label{rul:eq-ty-subst-cond} \showEqTySubstCond}

  {\label{rul:eq-subst-true} \showEqSubstTrue}

  {\label{rul:eq-subst-false} \showEqSubstFalse}

  {\label{rul:eq-subst-cond} \showEqSubstCond}

  {\label{rul:large-cond-true} \showLargeCondTrue}

  {\label{rul:large-cond-false} \showLargeCondFalse}

  {\label{rul:cond-true} \showCondTrue}

  {\label{rul:cond-false} \showCondFalse}

  {\label{rul:cong-large-cond} \showCongLargeCond}

  {\label{rul:cong-cond} \showCongCond}
\end{mathpar}

Once again, lemma~\ref{pbm:id-inversion} is safe.

\meta{TODO: Prove sanity.}

\subsection{J eliminator}
\label{sec:j-elim}

\begin{align*}
  \text{Term $\uu$, $\vv$, $\ww$}
    \bnf   {}& \ldots                        && \text{previous terms} \\
    \bnfor {}& \J{\A}{\uu}{\C}{\ww}{\vv}{\p} && \text{the J eliminator}
\end{align*}

\newcommand{\rlTermJ}{\referTo{term-j}{rul:term-j}}
\newcommand{\showTermJ}{%
  \infer[\rulename{term-j}] % TermJ
  {\istype{\G}{\A} \\
   \isterm{\G}{\uu}{\A} \\
   \istype
    {\ctxextend
      {\ctxextend{\G}{\A}}
      {\Id
        {\subst{\A}{\sbweak{\G}{\A}}}
        {\subst{\uu}{\sbweak{\G}{\A}}}
        {\var{0}}}
    }
    {\C} \\
   \isterm
    {\G}
    {\ww}
    {\subst
      {\subst
        {\C}
        {\sbshift
          {\G}
          {\Id
            {\subst{\A}{\sbweak{\G}{\A}}}
            {\subst{\uu}{\sbweak{\G}{\A}}}
            {\var{0}}
          }
          {\sbzero{\G}{\A}{\uu}}
        }
      }
      {\sbzero{\G}{\Id{\A}{\uu}{\uu}}{\refl{\A} \uu}}
    } \\
   \isterm{\G}{\vv}{\A} \\
   \isterm{\G}{\p}{\Id{\A}{\uu}{\vv}}
  }
  {\isterm{\G}
    {\J{\A}{\uu}{\C}{\ww}{\vv}{\p}}
    {\subst
      {\subst
        {\C}
        {\sbshift
          {\G}
          {\Id
            {\subst{\A}{\sbweak{\G}{\A}}}
            {\subst{\uu}{\sbweak{\G}{\A}}}
            {\var{0}}
          }
          {\sbzero{\G}{\A}{\vv}}
        }
      }
      {\sbzero{\G}{\Id{\A}{\uu}{\vv}}{\p}}
    }
  }
}

\newcommand{\rlEqSubstJ}{\referTo{eq-subst-j}{rul:eq-subst-j}}
\newcommand{\showEqSubstJ}{%
  \infer[\rulename{eq-subst-j}] % EqSubstJ
  {\issubst{\sbs}{\G}{\D} \\
   \istype{\D}{\A} \\
   \isterm{\D}{\uu}{\A} \\
   \istype
    {\ctxextend
      {\ctxextend{\D}{\A}}
      {\Id
        {\subst{\A}{\sbweak{\D}{\A}}}
        {\subst{\uu}{\sbweak{\D}{\A}}}
        {\var{0}}}
    }
    {\C} \\
   \isterm
    {\D}
    {\ww}
    {\subst
      {\subst
        {\C}
        {\sbshift
          {\D}
          {\Id
            {\subst{\A}{\sbweak{\D}{\A}}}
            {\subst{\uu}{\sbweak{\D}{\A}}}
            {\var{0}}
          }
          {\sbzero{\D}{\A}{\uu}}
        }
      }
      {\sbzero{\D}{\Id{\A}{\uu}{\uu}}{\refl{\A} \uu}}
    } \\
   \isterm{\D}{\vv}{\A} \\
   \isterm{\D}{\p}{\Id{\A}{\uu}{\vv}}
  }
  {\eqterm{\G}
    {\subst
      {\J{\A}{\uu}{\C}{\ww}{\vv}{\p}}
      {\sbs}
    }
    {\J
      {\subst{\A}{\sbs}}
      {\subst{\uu}{\sbs}}
      {\subst{\C}{\sbt}}
      {\subst{\ww}{\sbs}}
      {\subst{\vv}{\sbs}}
      {\subst{\p}{\sbs}}
    }
    {\subst
      {\subst
        {\subst
          {\C}
          {\sbr}
        }
        {\sbzero{\G}{\Id{\A}{\uu}{\vv}}{\p}}
      }
      {\sbs}
    }
  }

  \text{Where } \sbt =
    \sbshift
      {\ctxextend{\G}{\subst{\A}{\sbs}}}
      {\Id
        {\subst{\A}{\sbweak{\D}{\A}}}
        {\subst{\uu}{\sbweak{\D}{\A}}}
        {\var{0}}
      }
      {(\sbshift{\G}{\A}{\sbs})}

  \text{and } \sbr =
    \sbshift
      {\G}
      {\Id
        {\subst{\A}{\sbweak{\G}{\A}}}
        {\subst{\uu}{\sbweak{\G}{\A}}}
        {\var{0}}
      }
      {\sbzero{\G}{\A}{\vv}}
}

\newcommand{\rlCongJ}{\referTo{cong-j}{rul:cong-j}}
\newcommand{\showCongJ}{%
  \infer[\rulename{cong-j}] % CongJ
  {\eqtype{\G}{\A_1}{\A_2} \\
   \eqterm{\G}{\uu_1}{\uu_2}{\A_1} \\
   \eqtype
    {\ctxextend
      {\ctxextend{\G}{\A}}
      {\Id
        {\subst{\A}{\sbweak{\G}{\A}}}
        {\subst{\uu}{\sbweak{\G}{\A}}}
        {\var{0}}}
    }
    {\C_1}
    {\C_2} \\
   \eqterm
    {\G}
    {\ww_1}
    {\ww_2}
    {\subst
      {\subst
        {\C_1}
        {\sbshift
          {\G}
          {\Id
            {\subst{\A_1}{\sbweak{\G}{\A_1}}}
            {\subst{\uu_1}{\sbweak{\G}{\A_1}}}
            {\var{0}}
          }
          {\sbzero{\G}{\A_1}{\uu_1}}
        }
      }
      {\sbzero{\G}{\Id{\A_1}{\uu_1}{\uu_1}}{\refl{\A_1} \uu_1}}
    } \\
   \eqterm{\G}{\vv_1}{\vv_2}{\A_1} \\
   \eqterm{\G}{\p_1}{\p_2}{\Id{\A_1}{\uu_1}{\vv_1}}
  }
  {\eqterm{\G}
    {\J{\A_1}{\uu_1}{\C_1}{\ww_1}{\vv_1}{\p_1}}
    {\J{\A_2}{\uu_2}{\C_2}{\ww_2}{\vv_2}{\p_2}}
    {\subst
      {\subst
        {\C_1}
        {\sbr}
      }
      {\sbzero{\G}{\Id{\A_1}{\uu_1}{\vv_1}}{\p_1}}
    }
  }

  \text{Where } \sbr =
    \sbshift
      {\G}
      {\Id
        {\subst{\A_1}{\sbweak{\G}{\A_1}}}
        {\subst{\uu_1}{\sbweak{\G}{\A_1}}}
        {\var{0}}
      }
      {\sbzero{\G}{\A_1}{\vv_1}}
}

\newcommand{\rlJRefl}{\referTo{j-refl}{rul:j-refl}}
\newcommand{\showJRefl}{%
  \infer[\rulename{j-refl}] % JRefl
  {\istype{\G}{\A} \\
   \isterm{\G}{\uu}{\A} \\
   \istype
    {\ctxextend
      {\ctxextend{\G}{\A}}
      {\Id
        {\subst{\A}{\sbweak{\G}{\A}}}
        {\subst{\uu}{\sbweak{\G}{\A}}}
        {\var{0}}}
    }
    {\C} \\
   \isterm
    {\G}
    {\ww}
    {\subst
      {\subst
        {\C}
        {\sbt}
      }
      {\sbzero{\G}{\Id{\A}{\uu}{\uu}}{\refl{\A} \uu}}
    }
  }
  {\eqterm{\G}
    {\J{\A}{\uu}{\C}{\ww}{\uu}{\refl{\A} \uu}}
    {\ww}
    {\subst
      {\subst
        {\C}
        {\sbt}
      }
      {\sbzero{\G}{\Id{\A}{\uu}{\uu}}{\refl{\A} \uu}}
    }
  }

  \text{Where } \sbt =
    \sbshift
      {\G}
      {\Id
        {\subst{\A}{\sbweak{\G}{\A}}}
        {\subst{\uu}{\sbweak{\G}{\A}}}
        {\var{0}}
      }
      {\sbzero{\G}{\A}{\uu}}
}

\begin{mathpar}
  {\label{rul:term-j} \showTermJ}

  \label{rul:eq-subst-j} \showEqSubstJ

  \label{rul:cong-j} \showCongJ

  \label{rul:j-refl} \showJRefl
\end{mathpar}

Remark: Lemma~\ref{pbm:id-inversion} still holds with this extension.

\meta{TODO: Sanity.}

\subsection{W Types}
\meta{TODO?}
