
\section{Translation}
\label{sec:translation}

We need the following translations:
%
\begin{align}
  \label{lbl:ctx-ctr}
  \isctx{\G}
  &\quad\leadsto\quad
  \isctx{\G'}
  \\
  \label{lbl:ty-ctr}
  \G', (\istype{\G}{\A})
  &\quad\leadsto\quad
  \istype{\G'}{\A'}
  \\
  \label{lbl:ty-path}
  % the following is needed if we ever need to construct an equivalence given A',B' and A \equiv B
  (\istype{\G'}{\A'}), (\istype{\G}{\A})
  &\quad\leadsto\quad
  (\istype{\G'}{\A''}), (\G' \vdash \A' \simeq \A'')
  \\
  (\G', A'), (\isterm{\G}{\uu}{\A})
  &\quad\leadsto\quad
  \isterm{\G'}{\uu'}{\A'}
  \\
  % the following is needed if we ever need to construct an equivalence given u', v' and u \equiv v
  % (which happens if we need to construct an equivalence given A',B' and A \equiv B)
  \label{lbl:term-path}
  (\isterm{\G'}{\uu'}{\A'}), (\isterm{\G}{\uu}{\A})
  &\quad\leadsto\quad
  (\isterm{\G'}{\uu''}{\A'}), (\G' \vdash \uu' \simeq \uu'' : \A')
  \\
  \G', (\issubst{\sbs}{\G}{\D})
  &\quad\leadsto\quad
  \issubst{\sbs'}{\G'}{\D'}
  \\
  (\issubst{\sbs'}{\G'}{\D'}), (\issubst{\sbs}{\G}{\D})
  &\quad\leadsto\quad
  (\issubst{\sbs''}{\G'}{\D''}), (\sbs' \simeq \sbs'')
  \\
  \label{lbl:eq-ctx-path}
  \G', (\eqctx{\G}{\D})
  &\quad\leadsto\quad
  (\isctx{\D'}), (\G' \simeq \D')
  \\
  \label{lbl:eq-ty-path}
  \G', \B', (\eqtype{\G}{\A}{\B})
  &\quad\leadsto\quad
  (\istype{\G'}{\A'}), (\G' \vdash \A' \simeq \B')
  \\
  \label{lbl:eq-term-path}
  \G', \A', \vv', (\eqterm{\G}{\uu}{\vv}{\A})
  &\quad\leadsto\quad
  (\isterm{\G'}{\A'}{\uu'}), (\G' \vdash \uu' \simeq \vv' : \A')
\end{align}
%
Remarks:
%
\begin{itemize}
\item \eqref{lbl:ty-path} must be implemented via~\eqref{lbl:eq-ty-path}
\item \eqref{lbl:term-path} must be implemented via~\eqref{lbl:eq-term-path}
\end{itemize}





\newpage
\hrulefill

An \emph{isomorphism} between $\A$ and $\B$ is given by terms $f : \A \to \B$ and
$g : \B \to \A$ together with terms of type $\Prod{x}{\A} \Id{\A}{g \, (f \, x)}{x}$ and
$\Prod{y}{\B} \Id{\B}{f \, (g \, y)}{y}$. We indicate that such an equivalence is given by
writing $\Iso{\A}{\B}$, while keeping in mind that this is meta-notation. (The point here
is that since we do not necessarily have dependent sums, we cannot easily define the type
of isomorphisms.)

We construct a translation $\tran{\derives{\DD}{\JJ}}$ such that:
%
\begin{itemize}
\item $\tran{\derives{\DD}{\isctx{\G}}}$ is a derivation of the form $\derives{\DD'}{\isctx{\G'}}$,
\item $\tran{\derives{\DD}{\istype{\G}{\A}}}$ is a derivation of the form $\derives{\DD'}{\istype{\G'}{\A'}}$,
\item $\tran{\derives{\DD}{\isterm{\G}{\uu}{\A}}}$ is a derivation of the form $\derives{\DD'}{\isterm{\G'}{\uu'}{\A'}}$,
\item $\tran{\derives{\DD}{\issubst{\sbs}{\G}{\D}}}$ is a derivation of the form $\derives{\DD}{\issubst{\sbs'}{\G'}{\D'}}$,
\item $\tran{\derives{\DD}{\eqctx{\G}{\D}}}$ is a derivation of the form
  $\derives{\DD'}{\issubst{\sbs}{\G'}{\D'}}$ such that $\sbs$ is an isomorphism of
  contexts (TODO: define this),
\item $\tran{\derives{\DD}{\eqtype{\G}{\A}{\B}}}$ is an isomorphism $\Iso{\A}{\B}$,
\item $\tran{\derives{\DD}{\eqterm{\G}{\uu}{\vv}{\A}}}$ is a derivation of the form
  $\derives{\DD'}{\isterm{\G}{p}{\Id{\A}{\uu'}{\vv'}}}$.
\end{itemize}
%
We construct an auxiliary function $\conn{\derives{\DD}{\JJ}}{\derives{\EE}{\JJ}}$, such that:
%
\begin{itemize}
\item specify things here
\end{itemize}

\subsection{Construction of $\tran{{-}}$}
\label{sec:construction-tran}

\Case{ctx-empty}
%
The derivation
%
\begin{equation*}
  \infer{ }{\isctx{\ctxempty}}
\end{equation*}
%
is translated into
%
\begin{equation*}
  \infer{ }{\isctx{\ctxempty}}
\end{equation*}


\Case{ctx-extend}

Consider the derivation
%
%
\begin{equation*}
  \infer{
    \inferrule*{\DD}{\isctx{\G}} \\
    \inferrule*{\EE}{\istype{\G}{\A}} \\
    x \not\in \ctxdom{\G}
  }
  {\isctx{(\ctxextend{\G}{\x}{\A})}}
\end{equation*}
%
By~\eqref{lbl:ctx-ctr} on $\derives{\DD}{\isctx{\G}}$, we get
$\derives{\DD'}{\isctx{\G'}}$.
By~\eqref{lbl:ty-ctr} on $\derives{\EE}{\istype{\G}{\A}}$ and $\G'$, we get
$\derives{\EE'}{\istype{\G'}{\A'}}$.
Since $\ctxdom{\G} = \ctxdom{\G'}$, we have $x \notin \ctxdom{\G'}$ and thus
%
\begin{equation*}
  \infer{
    \inferrule*{\DD'}{\isctx{\G'}} \\
    \inferrule*{\EE'}{\istype{\G'}{\A'}} \\
    x \not\in \ctxdom{\G'}
  }
  {\isctx{(\ctxextend{\G'}{\x}{\A'})}}
\end{equation*}


\Case{ty-ctx-conv}

Consider the derivation
%
%
\begin{equation*}
  \infer{
    \inferrule*{\DD}{\istype{\G}{\A}} \\
    \inferrule*{\EE}{\eqctx{\G}{\D}}
  }
  {\istype{\D}{\A}}
\end{equation*}
%
We need to prove~\eqref{lbl:ty-ctr} and~\eqref{lbl:ty-path}.
First assume we have $\D'$ a translation of $\D$.
From $\derives{\EE}{\eqctx{\G}{\D}}$ and $\D'$, we
apply~\eqref{lbl:eq-ctx-path} (\meta{in the symmetric version}) and we deduce
$\G'$ a translation of $\G$ such that $\G' \simeq \D'$ (meaning that in
particular we have some morphism $f$ from $\G'$ to $\D'$).
From $\G'$ and $\derives{\DD}{\istype{\G}{\A}}$, we apply~\eqref{lbl:ty-ctr}
to get $\derives{\DD'}{\istype{\G'}{\A'}}$.
We can finally build the translation:
%
\begin{equation*}
  \infer{
    \inferrule*{\DD'}{\istype{\G'}{\A'}} \\
    \issubst{f}{\D'}{\G'}
  }
  {\istype{\D'}{\subst{\A'}{f}}}
\end{equation*}
%
\meta{We need to specify who is $f$ (and its derivation) and how it applies.}
%
\meta{TODO}





%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
