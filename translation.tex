
\section{Translation}
\label{sec:translation}

We need the following translations:
%
\begin{align}
  \label{lbl:ctx-ctr}
  \isctx{\G}
  &\quad\leadsto\quad
  \isctx{\G'}
  \\
  \label{lbl:ty-ctr}
  \G', (\istype{\G}{\A})
  &\quad\leadsto\quad
  \istype{\G'}{\A'}
  \\
  \label{lbl:ty-path}
  % the following is needed if we ever need to construct an equivalence given A',B' and A \equiv B
  (\istype{\G'}{\A'}), (\istype{\G}{\A})
  &\quad\leadsto\quad
  (\istype{\G'}{\A''}), (\G' \vdash \A' \simeq \A'')
  \\
  \label{lbl:term-ctr}
  (\G', A'), (\isterm{\G}{\uu}{\A})
  &\quad\leadsto\quad
  \isterm{\G'}{\uu'}{\A'}
  \\
  % the following is needed if we ever need to construct an equivalence given u', v' and u \equiv v
  % (which happens if we need to construct an equivalence given A',B' and A \equiv B)
  \label{lbl:term-path}
  (\isterm{\G'}{\uu'}{\A'}), (\isterm{\G}{\uu}{\A})
  &\quad\leadsto\quad
  (\isterm{\G'}{\uu''}{\A'}), (\G' \vdash \uu' \simeq \uu'' : \A')
  \\
  \label{lbl:subst-ctr}
  \G', (\issubst{\sbs}{\G}{\D})
  &\quad\leadsto\quad
  \issubst{\sbs'}{\G'}{\D'}
  \\
  \label{lbl:subst-path}
  (\issubst{\sbs'}{\G'}{\D'}), (\issubst{\sbs}{\G}{\D})
  &\quad\leadsto\quad
  (\issubst{\sbs''}{\G'}{\D''}), (\sbs' \simeq \sbs'')
  \\
  \label{lbl:eq-ctx-path}
  \G', (\eqctx{\G}{\D})
  &\quad\leadsto\quad
  (\isctx{\D'}), (\G' \simeq \D')
  \\
  \label{lbl:eq-ty-path}
  \G', \B', (\eqtype{\G}{\A}{\B})
  &\quad\leadsto\quad
  (\istype{\G'}{\A'}), (\G' \vdash \A' \simeq \B')
  \\
  \label{lbl:eq-term-path}
  \G', \A', \vv', (\eqterm{\G}{\uu}{\vv}{\A})
  &\quad\leadsto\quad
  (\isterm{\G'}{\A'}{\uu'}), (\G' \vdash \uu' \simeq \vv' : \A')
\end{align}
%
Remarks:
%
\begin{itemize}
\item \eqref{lbl:ty-path} must give the same result as~\eqref{lbl:eq-ty-path} applied to
  the reflexivity case. This is so that we can use the result of~\eqref{lbl:eq-ty-path} as
  if it were obtained through conversion.
\item \eqref{lbl:term-path} must give the same result as~\eqref{lbl:eq-term-path} applied
  to the reflexivity case, for similar reasons.
\item We will need to know that all the equivalences generated from the derivations of a
  given equation are equal (propositionally pointwise). This is where UIP will come into
  play, since such equivalences are compositions of structural acrobatics and transports
  along paths used in $\rl{eq-reflection}$.
\item We also need to know that translations of contexts have the same shape
  as the original context, and the same goes for translation of types up
  to context isomorphisms.
\item In the rules producing isomorphims, we actually assume that the center
  generated is the same as the one that would be generated by the corresponding
  ``simple'' rule.
\item Assume $\isterm{\G}{\uu}{\A}$ and $\theta : \G'' \simeq \G'$ and $\A'$
  is a translation of $\A$ (in $\G'$) then instead of
  $(\G'', \subst{\A'}{\theta})$ as input for~\eqref{lbl:term-ctr}, we can
  use $(\G',\A')$.
  Indeed, we would get $\isterm{\G'}{\uu'}{\A'}$ and then deduce
  $\isterm{\G''}{\subst{\uu'}{\theta}}{\subst{\A'}{\theta}}$.
  This means that we can always assume the type we get as input
  for~\eqref{lbl:term-ctr} to be of the same shape as the original type.
  The same goes for~\eqref{lbl:term-path}.
\item Same thing for~\eqref{lbl:eq-ty-path}, we can assume that the given type
  is always of the same shape as the untranslated one.
\end{itemize}


\subsection{Proof of the translation}
\label{sec:proof-tran}

\Case{ctx-empty}
%
The derivation
%
\begin{equation*}
  \infer{ }{\isctx{\ctxempty}}
\end{equation*}
%
is translated into
%
\begin{equation*}
  \infer{ }{\isctx{\ctxempty}}
\end{equation*}


\Case{ctx-extend}

Consider the derivation
%
%
\begin{equation*}
  \infer{
    \inferrule*{\DD}{\isctx{\G}} \\
    \inferrule*{\EE}{\istype{\G}{\A}}
  }
  {\isctx{(\ctxextend{\G}{\A})}}
\end{equation*}
%
By~\eqref{lbl:ctx-ctr} on $\derives{\DD}{\isctx{\G}}$, we get
$\derives{\DD'}{\isctx{\G'}}$.
By~\eqref{lbl:ty-ctr} on $\derives{\EE}{\istype{\G}{\A}}$ and $\G'$, we get
$\derives{\EE'}{\istype{\G'}{\A'}}$.
% Since $\ctxdom{\G} = \ctxdom{\G'}$, we have $x \notin \ctxdom{\G'}$ and thus
%
\begin{equation*}
  \infer{
    \inferrule*{\DD'}{\isctx{\G'}} \\
    \inferrule*{\EE'}{\istype{\G'}{\A'}} \\
    % x \not\in \ctxdom{\G'}
  }
  {\isctx{(\ctxextend{\G'}{\A'})}}
\end{equation*}


\Case{ty-ctx-conv}

Consider the derivation
%
%
\begin{equation*}
  \infer{
    \inferrule*{\DD}{\istype{\G}{\A}} \\
    \inferrule*{\EE}{\eqctx{\G}{\D}}
  }
  {\istype{\D}{\A}}
\end{equation*}
%
We need to prove~\eqref{lbl:ty-ctr} and~\eqref{lbl:ty-path}.
First assume we have $\D'$ a translation of $\D$.
From $\derives{\EE}{\eqctx{\G}{\D}}$ and $\D'$, we
apply~\eqref{lbl:eq-ctx-path} (\meta{in the symmetric version}) and we deduce
$\G'$ a translation of $\G$ such that $\G' \simeq \D'$ (meaning that in
particular we have some morphism $f$ from $\G'$ to $\D'$).
From $\G'$ and $\derives{\DD}{\istype{\G}{\A}}$, we apply~\eqref{lbl:ty-ctr}
to get $\derives{\DD'}{\istype{\G'}{\A'}}$.
We can finally build the translation:
%
\begin{equation*}
  \infer{
    \inferrule*{\DD'}{\istype{\G'}{\A'}} \\
    \issubst{\f}{\D'}{\G'}
  }
  {\istype{\D'}{\subst{\A'}{f}}}
\end{equation*}
%
\meta{We need to specify who is $\f$ (and its derivation) and how it applies.}

Now, let's extend our proof to match~\eqref{lbl:ty-path}.
Assume we are given $\istype{\D'}{\A''}$, let's build an equivalence
$\D' \vdash \subst{\A'}{\f} \simeq \A''$.
Since $\G' \simeq \D'$, we have an inverse to $\f$, say $\g$.
For this we deduce $\istype{\G'}{\subst{\A''}{\g}}$.
Using this, together with $\istype{\G'}{\A'}$, we can apply~\eqref{lbl:ty-path}
to get some isomorphism $\G' \vdash \A' \simeq \subst{\A''}{\g}$.
From this we can build an isomorphism
$\D' \vdash \subst{\A'}{\f} \simeq \subst{\subst{\A''}{\g}}{\f}$.
But as we said, $\g$ and $\f$ are inverses, so
$\D' \vdash \subst{\subst{\A''}{\g}}{\f} \simeq \A''$, hence
$\D' \vdash \subst{\A'}{\f} \simeq \A''$.

\Case{ty-subst}
\meta{TODO}

\Case{ty-prod}

Consider
%
\begin{equation*}
  \infer{
    \inferrule*{\DD}{\istype{\G}{\A}} \\
    \inferrule*{\EE}{\istype{\ctxextend{\G}{\A}}{\B}}
  }
  {\istype{\G}{\Prod{\A}{\B}}}
\end{equation*}
%
We prove~\eqref{lbl:ty-ctr} and then~\eqref{lbl:ty-path}.
Assume $\G'$, from~\eqref{lbl:ty-ctr}, we get $\istype{\G'}{\A'}$ and then
using $\ctxextend{\G'}{\A'}$
% (well-formed since $x \notin \ctxdom{\G} = \ctxdom{\G'}$)
we get $\istype{\ctxextend{\G'}{\A'}}{\B'}$.
Finally we reconstruct $\istype{\G'}{\Prod{\A'}{\B'}}$.

Now, to prove~\eqref{lbl:ty-path}, assume $\istype{\G'}{\C''}$
is some translation of $\istype{\G}{\Prod{\A}{\B}}$.
If we invert on the translation, $\C''$ is actually an arbitrary number
(possibly zero) of context morphisms applied to a $\Pi$-type translation
$\istype{\G''}{\Prod{\A''}{\B''}}$.
To simplify matters, we assume we only have one such context morphism
$\G' \simeq \G''$ with $\issubst{\f}{\G''}{\G'}$ and $\issubst{\g}{\G'}{\G''}$
which is the composition of all the substitutions (in case we have none, this
would result in the identity morphism). It is indeed admissible as we can show
an equivalence between the two types (the one with one, and the one with an
arbitrary number of substitutions in its head).
By inversion, $\istype{\G''}{\A''}$, and thus $\istype{\G'}{\subst{\A''}{\g}}$
so by~\eqref{lbl:ty-path}, we have $\G' \vdash \subst{\A''}{\g} \simeq \A'$,
in particular, we can extend $\f$ and $\g$ into $\f'$ and $\g'$ to get an
isomorphism $\ctxextend{\G'}{\A'} \simeq \ctxextend{\G''}{\A''}$.
By inversion, we also have $\istype{\ctxextend{\G''}{\A''}}{\B''}$,
and thus $\istype{\ctxextend{\G'}{\A'}}{\subst{\B''}{\g'}}$,
so by~\eqref{lbl:ty-path}, we have
$\ctxextend{\G'}{\A'} \vdash \subst{\B''}{\g'} \simeq \B'$.

We can derive from that
$\G' \vdash \Prod{\subst{\A''}{\g}}{\subst{\B''}{\g'}}
\simeq \Prod{\A'}{\B'}$.
However, \meta{magically},
$\G' \vdash \Prod{\subst{\A''}{\g}}{\subst{\B''}{\g'}}
\simeq \subst{(\Prod{\A''}{\B''})}{\g}$,
which gives the expected conclusion by transitivity.
(\meta{We should write it in a better way.})

\Case{ty-id}

Consider
%
\begin{equation*}
  \infer{
    \istype{\G}{\A} \\
    \isterm{\G}{\uu}{\A} \\
    \isterm{\G}{\vv}{\A}
  }
  {\istype{\G}{\Id{\A}{\uu}{\vv}}}
\end{equation*}
%
First, let us handle~\eqref{lbl:ty-ctr}. Assume $\G'$ a translation of $\G$.
From~\eqref{lbl:ty-ctr}, we get $\istype{\G'}{\A'}$ and
from~\eqref{lbl:term-ctr} using $\G'$ and $\A'$, we get
$\isterm{\G'}{\uu'}{\A'}$ and $\isterm{\G'}{\vv'}{\A'}$.
We finally have $\istype{\G'}{\Id{\A'}{\uu'}{\vv'}}$.

\sloppy
Now, let us prove~\eqref{lbl:ty-path} by assuming $\istype{\G'}{\C''}$ another
translation of $\istype{\G}{\Id{\A}{\uu}{\vv}}$.
Using the same trick as before, \eqref{lbl:ty-path} and~\eqref{lbl:term-path},
and the \meta{magic} fact that
%
\begin{equation*}
  \G' \vdash \Id{\subst{\A''}{\g}}{\subst{\uu''}{\g}}{\subst{\vv''}{\g}}
  \simeq \subst{(\Id{\A''}{\uu''}{\vv''})}{\g},
\end{equation*}
%
we can conclude.

\Case{term-ty-conv}

Consider
%
\begin{equation*}
  \infer{
    \isterm{\G}{\uu}{\A} \\
    \eqtype{\G}{\A}{\B}
  }
  {\isterm{\G}{\uu}{\B}}
\end{equation*}
%
This time we have to prove~\eqref{lbl:term-ctr} and~\eqref{lbl:term-path}.
First, for~\eqref{lbl:term-ctr}, assume $\G'$ and $\B'$ respective translations
of $\G$ and $\B$. From that and~\eqref{lbl:eq-ty-path} we get
$\istype{\G'}{\A'}$ and some equivalence $\G' \vdash \A' \simeq \B'$.
From $\G'$, $\A'$ and~\eqref{lbl:term-ctr}, we get $\isterm{\G'}{\uu'}{\A'}$.
We take the direct map from the equivalence $\f$ and finally
conclude $\isterm{\G'}{\app{\f}{\A'}{\B'}{\uu'}}{\B'}$.

Now, for~\eqref{lbl:term-path}, assume another translation
$\isterm{\G'}{\uu''}{\B'}$.
Using $\g$, the inverse of $\f$, we get
$\isterm{\G'}{\app{\g}{\B'}{\A'}{\uu''}}{\A'}$ which is a valid translation
thanks to the remarks. Thus, using~\eqref{lbl:term-path}, we get an equivalence
$\G' \vdash \app{\g}{\B'}{\A'}{\uu''} \simeq \uu' : \A'$.
From it we deduce the equivalence
$\G' \vdash \app{\f}{\A'}{\B'}{(\app{\g}{\B'}{\A'}{\uu''})}
\simeq \app{\f}{\A'}{\B'}{\uu'} : \A'$.
Since $\f$ and $\g$ are inverses, we have
$\G' \vdash \app{\f}{\A'}{\B'}{(\app{\g}{\B'}{\A'}{\uu''})}
\simeq \uu'' : \A'$ and so
$\G' \vdash \uu'' \simeq \app{\f}{\A'}{\B'}{\uu'} : \A'$.

\Case{term-ctx-conv}

%
\begin{equation*}
  \infer{
    \isterm{\G}{\uu}{\A} \\
    \eqctx{\G}{\D}
  }
  {\isterm{\D}{\uu}{\A}}
\end{equation*}

\eqref{lbl:term-ctr}: Assume $\D'$ and $\A'$.
By~\eqref{lbl:eq-ctx-path}, we have $\G'$ and $\G' \simeq \D'$.
Then\footnote{Assuming $\subst{\A'}{\g}$ is a suitable translation!},
by~\eqref{lbl:term-ctr}, $\isterm{\G'}{\uu'}{\subst{\A'}{\g}}$ and thus
$\isterm{\D'}{\subst{\uu'}{\f}}{\A'}$ (where $\f$ and $\g$ are the equivalence
$\G' \simeq \D'$). \meta{(How do we get rid of $\subst{\subst{\A'}{\g}}{\f}$
in favor of $\A'$? Probably by conversion in the target.)}

\eqref{lbl:term-path}: Moreover assume $\isterm{\D'}{\uu''}{\A'}$.
Thus, $\isterm{\G'}{\subst{\uu''}{\g}}{\subst{\A'}{\g}}$.
We deduce form~\eqref{lbl:term-path} that
$\G' \vdash \subst{\uu''}{\g} \simeq \uu' : \subst{\A'}{\g}$.
And finally
$\G' \vdash \uu'' \simeq \subst{\uu'}{\f} : \A'$.

\Case{term-subst}

\meta{TODO}

\Case{term-var}

%
\begin{equation*}
  \infer{
    \isctx{\G} \\
    % \x \not\in \ctxdom{\G} \\
    \istype{\G}{\A} \\
  }{
    \isterm
      {\ctxextend{\G}{\A}}
      {\x}
      {\A}
  }
\end{equation*}

\eqref{lbl:term-ctr}: Assume $\ctxextend{\G'}{\A'}$ a translation of
$\ctxextend{\G}{\A}$ and $\A''$ a translation of $\A$.
By definition of a translation of contexts, $\G'$ is a translation of
$\G$ and $\A'$ a translation of $\A$.
\meta{Besides}, we have $\isctx{\G'}$ and $\istype{\G'}{\A''}$.
Since, for $\A'$ is also a translation of $\A$, we have $\istype{\G'}{\A'}$
\meta{(we need some strengthening by saying that $\x$ should not appear in
$\A'$)}, we can apply~\eqref{lbl:ty-path} twice to get an equivalence
$\G' \vdash \A' \simeq \A''$.
Thanks to the rule \rl{term-var}, we have
$\isterm{\ctxextend{\G'}{\A'}}{\x}{\A'}$
and then
$\isterm{\ctxextend{\G'}{\A'}}{\app{\f}{\A'}{\A''}{\x}}{\A''}$
where $\f$ is one of the underlying maps of the equivalence.

\eqref{lbl:term-path}: Assume, moreover, that
$\isterm{\ctxextend{\G'}{\A'}}{\uu'}{\A''}$
is another translation. Let's build an equivalence between it and the one we
produced.
\meta{This is where things start to be complicated. We can indeed say that
any translation of $\x$ has to be $\x$ transported along isomorphisms and
context isomorphisms. We apply all of their inverses in the right order to
discover $\x$ in an equivalent context, and at an equivalent type.
This is probably one of the times where we require the produced equivalences
to be equal.}


\Case{term-var-skip}

\begin{equation*}
  \infer{
    \isterm{\G}{\x}{\A} \\
    % \y \not\in \ctxdom{\G} \\
    \istype{\G}{\B}
  }{
    \isterm
      {\ctxextend{\G}{\B}}
      {\x}
      {\A}
  }
\end{equation*}

\eqref{lbl:term-ctr}: Assume $\ctxextend{\G'}{\B'}$ and $\A'$
respective translations of $\ctxextend{\G}{\B}$ and $\A$.
By definition of a context translation, $\G'$ is a translation of $\G$.
Thus, by~\eqref{lbl:term-ctr} on $\isterm{\G}{\x}{\A}$, we have
$\isterm{\G'}{\uu'}{\A'}$ a translation.
% We still have $\y \notin \ctxdom{\G'}$.
And since $\B'$ is a translation of $\B$ in translated context $\G'$,
we have $\istype{\G'}{\B'}$, from that we conclude
$\isterm{\ctxextend{\G'}{\B'}}{\uu'}{\A'}$.

\eqref{lbl:term-path}: Assume, moreover, that
$\isterm{\ctxextend{\G'}{\B'}}{\uu''}{\A'}$
is another translation, let's build a path.
\meta{Here it is unclear how to remove $\y$ from the context to use the
induction hypothesis...}


\Case{term-abs}

\begin{equation*}
  \infer
  {\isterm{\ctxextend{\G}{\A}}{\uu}{\B}}
  {\isterm{\G}{(\lam{\A}{\B}{\uu})}{\Prod{\A}{\B}}}
\end{equation*}

\eqref{lbl:term-ctr}: Assume $\G'$ and $\Prod{\A'}{\B'}$ are respective
translations of $\G$ and $\Prod{\A}{\B}$ (thanks to one of the remarks).
We can thus extend $\G'$ with $\istype{\G'}{\A'}$ and we have
$\istype{\ctxextend{\G'}{\A'}}{\B'}$.
This implies that, by~\eqref{lbl:term-ctr}, we have
$\isterm{\ctxextend{\G'}{\A'}}{\uu'}{\B'}$
and so
$\isterm{\G'}{(\lam{\A'}{\B'}{\uu'})}{\Prod{\A'}{\B'}}$.

\eqref{lbl:term-path}; Assume, moreover, that
$\isterm{\G'}{\vv'}{\Prod{\A'}{\B'}}$ is another translation.
We get $\isterm{\ctxextend{\G'}{\A'}}{\app{\vv'}{\A'}{\B'}{\x}}{\B'}$.
It is a translation of $\isterm{\ctxextend{\G}{\A}}{\uu}{\B}$
\meta{(why?)}.
Then, by~\eqref{lbl:term-path},
$\ctxextend{\G'}{\A'} \vdash \app{\vv'}{\A'}{\B'}{\x} \simeq
\uu' : \B'$.
Thus,
$\G' \vdash \lam{\A'}{\B'}{\app{\vv'}{\A'}{\B'}{\x}} \simeq
\lam{\A'}{\B'}{\uu'} : \Prod{\A'}{\B'}$.
Since $\G' \vdash \lam{\A'}{\B'}{\app{\vv'}{\A'}{\B'}{\x}} \simeq
\vv' : \Prod{\A'}{\B'}$ \meta{(by $\eta$ for propositional equality)},
we conclude
$\G' \vdash \vv' \simeq \lam{\A'}{\B'}{\uu'} : \Prod{\A'}{\B'}$.


\Case{term-app}

\begin{equation*}
  \infer{
    \isterm{\G}{\uu}{\Prod{\A} \B} \\
    \isterm{\G}{\vv}{\A}
  }{
    \isterm
      {\G}
      {\app{\uu}{\A}{\B}{\vv}}
      {\subst{\B}{\sbextend{\sbunit{\G}}{\vv}}}
  }
\end{equation*}

\eqref{lbl:term-ctr}:
Assume $\G'$ and \meta{TODO: We need to know more about how substituted types
are translated!}


\Case{term-refl}

\begin{equation*}
  \infer
  {\isterm{\G}{\uu}{\A}}
  {\isterm{\G}{\refl{\A} \uu}{\Id{\A}{\uu}{\uu}}}
\end{equation*}

\eqref{lbl:term-ctr}:
Assume $\G'$ and $\Id{\A'}{\uu'}{\uu''}$ respective translations of $\G$ and
$\Id{\A}{\uu}{\uu}$.
In particular, $\isterm{\G'}{\uu'}{\A'}$ and $\isterm{\G'}{\uu''}{\A'}$
are both translations of $\isterm{\G}{\uu}{\A}$, so by
using~\eqref{lbl:term-path} twice and transitivity, we get a path
$\G' \vdash \uu' \simeq \uu'' : \A'$, say $\p$.
We deduce $\isterm{\G'}{\p}{\Id{\A'}{\uu'}{\uu''}}$.

\eqref{lbl:term-path}:
Assume, moreover, that $\isterm{\G'}{\q}{\Id{\A'}{\uu'}{\uu''}}$ is another
translation.
\meta{Here, we probably have to use the UIP legacy somehow...}


\Case{eq-ctx-empty}

\begin{equation*}
  \infer
  { }
  {\eqctx{\ctxempty}{\ctxempty}}
\end{equation*}
%
We have to prove~\eqref{lbl:eq-ctx-path}.
Assume we have a translation of $\ctxempty$, this has to be $\ctxempty$
by definition. Obviously $\ctxempty$ is a valid translation of the other
context, and we return the trivial isomorphism.


\Case{eq-ctx-extend}

\begin{equation*}
  \infer
  {\eqctx{\G}{\D} \\
   \eqtype{\G}{\A}{\B} \\
  %  x \not\in \ctxdom{\G}
  }
  {\eqctx{(\ctxextend{\G}{\A})}{(\ctxextend{\D}{\B})}}
\end{equation*}
%
\eqref{lbl:eq-ctx-path}:
Assume $\ctxextend{\G'}{\A'}$ is a translation of $\ctxextend{\G}{\A}$.
In particular we have $\G'$ a translation for $\G$ and $\istype{\G'}{\A'}$
a translation of $\istype{\G}{\A}$.
From~\eqref{lbl:eq-ctx-path}, we get $\D'$ a translation of $\D$ and
an isomorphism $\G' \simeq \D'$.
By~\eqref{lbl:eq-ty-path}, we get $\B'$ such that $\G' \vdash \A' \simeq \B'$.
Calling $\theta$ the isomorphism from $\D'$ to $\G'$, we have
$\istype{\D'}{\subst{\B'}{\theta}}$.
All this allows to extend the isomorphism to
$(\ctxextend{\G'}{\A'}) \simeq (\ctxextend{\D'}{\subst{\B'}{\theta}})$.


\Case{eq-ty-conv}

\begin{equation*}
  \infer
  {\eqtype{\G}{\A}{\B}\\
    \eqctx{\G}{\D}}
  {\eqtype{\D}{\A}{\B}}
\end{equation*}
%
We only have to prove~\eqref{lbl:eq-ty-path}.
Assume we are given $\D'$ and $\B'$.
By~\eqref{lbl:eq-ctx-path}, we get $\G'$ and $\G' \simeq \D'$
with underlying $\issubst{\theta}{\G'}{\D'}$.
From that we get $\istype{\G'}{\subst{\B'}{\theta}}$ and
then, by~\eqref{lbl:eq-ty-path}, we get $\istype{\G'}{\A'}$
and $\G' \vdash \A' \simeq \subst{B'}{\theta}$.
We thus deduce $\istype{\D'}{\subst{\A'}{\theta^{-1}}}$
and $\D' \vdash \subst{\A'}{\theta^{-1}} \simeq \B'$.


\Case{eq-ty-refl}

\begin{equation*}
  \infer
  {\istype{\G}{\A}}
  {\eqtype{\G}{\A}{\A}}
\end{equation*}
%
\eqref{lbl:eq-ty-path}:
Assume $\G'$ and $\A'$.
We simply return $\A'$ and the identity isomorphism.


\Case{eq-ty-sym}

\begin{equation*}
  \infer
  {\eqtype{\G}{\B}{\A}}
  {\eqtype{\G}{\A}{\B}}
\end{equation*}
%
\eqref{lbl:eq-ty-path}:
Assume $\G'$ and $\B'$.
We just use the reverse~\eqref{lbl:eq-ty-path}.


\Case{eq-ty-trans}

\begin{equation*}
  \infer
  {\eqtype{\G}{\A}{\B}\\
   \eqtype{\G}{\B}{\C}}
  {\eqtype{\G}{\A}{\C}}
\end{equation*}
%
\eqref{lbl:eq-ty-path}:
Assume $\G'$ and $\C'$.
By~\eqref{lbl:eq-ty-path} on $\eqtype{\G}{\B}{\C}$, we get
$\istype{\G'}{\B'}$ and $\G' \vdash \B' \simeq \C'$.
Then, by~\eqref{lbl:eq-ty-path} again, on $\eqtype{\G}{\A}{\B}$,
we get $\istype{\G'}{\A'}$ and $\G' \vdash \A' \simeq \B'$.
By transitivity, we get $\G' \vdash \A' \simeq \C'$.


\Case{eq-subst-prod}

\meta{TODO}


\Case{eq-subst-id}

\meta{TODO}


\Case{cong-prod}

\begin{equation*}
  \infer
  {\eqtype{\G}{\A_1}{\B_1}\\
   \eqtype{\ctxextend{\G}{\A_1}}{\A_2}{\B_2}}
  {\eqtype{\G}{\Prod{\A_1}{\A_2}}{\Prod{\B_1}{\B_2}}}
\end{equation*}
%
\eqref{lbl:eq-ty-path}:
Assume $\G'$ and $\istype{\G'}{\Prod{\B_1'}{\B_2'}}$.
In particular, by inversion, $\istype{\G'}{\B_1'}$.
So, by~\eqref{lbl:eq-ty-path}, $\istype{\G'}{\A_1'}$ and
$\G' \vdash \A_1' \simeq \B_1'$.
By inversion, we also have $\istype{\ctxextend{\G'}{\B_1'}}{\B_2'}$.
Naming $\f$ the underlying map of the isomorphism from $\A_1'$ to $\B_1'$,
we have
$\istype
  {\ctxextend{\G'}{\A_1'}}
  {\subst{\B_2'}{\sbextend{\sbunit{\G'}}{\app{\f}{\A_1'}{\B_1'}{\x}}}}$.
\meta{(Why is that a valid translation?)}
From that and~\eqref{lbl:eq-ty-path} we get
$\istype{\ctxextend{\G'}{\A_1'}}{\A_2'}$ and
$\ctxextend{\G'}{\A_1'} \vdash \A_2' \simeq
\subst{\B_2'}{\sbextend{\sbunit{\G'}}{\app{\f}{\A_1'}{\B_1'}{\x}}}$.
This \meta{should be} enough to conclude
$\istype{\G'}{\Prod{\A_1'}{\A_2'}}$ and
$\G' \vdash \Prod{\A_1'}{\A_2'} \simeq \Prod{\B_1'}{\B_2'}$.


\Case{cong-id}

\begin{equation*}
  \infer
  {\eqtype{\G}{\A}{\B}\\
   \eqterm{\G}{\uu_1}{\vv_1}{\A}\\
   \eqterm{\G}{\uu_2}{\vv_2}{\A}
  }
  {\eqtype{\G}{\Id{\A}{\uu_1}{\uu_2}}
              {\Id{\B}{\vv_1}{\vv_2}}}
\end{equation*}
%
\eqref{lbl:eq-ty-path}:
Assume $\G'$ and $\Id{\B'}{\vv_1'}{\vv_2'}$.
By inversion, $\istype{\G'}{\B'}$ and $\isterm{\G'}{\vv_1'}{\B'}$
and $\isterm{\G'}{\vv_2'}{\B'}$.
By~\eqref{lbl:eq-ty-path}, $\istype{\G'}{\A'}$ and $\G' \vdash \A' \simeq \B'$
with $\f$ the underlying map from $\B'$ to $\A'$.
Then $\isterm{\G'}{\app{\f}{\B'}{\A'}{\vv_1'}}{\A'}$ and
$\isterm{\G'}{\app{\f}{\B'}{\A'}{\vv_2'}}{\A'}$.
We deduce from~\eqref{lbl:eq-term-path} that
$\isterm{\G'}{\uu_1'}{\A'}$ and $\isterm{\G'}{\uu_2'}{\A'}$ and
$\G' \vdash \uu_1' \simeq \app{\f}{\B'}{\A'}{\vv_1'} : \A'$ and
$\G' \vdash \uu_2' \simeq \app{\f}{\B'}{\A'}{\vv_2'} : \A'$.
This is enough to get $\istype{\G'}{\Id{\A'}{\uu_1'}{\uu_2'}}$ and
$\G' \vdash \Id{\A'}{\uu_1'}{\uu_2'} \simeq \Id{\B'}{\vv_1'}{\vv_2'}$.


\Case{cong-ty-subst}

\meta{TODO}


\Case{eq-ty-conv}

\begin{equation*}
  \infer
  {\eqterm{\G}{\uu}{\vv}{\A}\\
    \eqtype{\G}{\A}{\B}}
  {\eqterm{\G}{\uu}{\vv}{\B}}
\end{equation*}
%
\eqref{lbl:eq-term-path}:
Assume $\G'$ and $\B'$ and $\vv'$.
By~\eqref{lbl:eq-ty-path}, we get $\istype{\G'}{\A'}$ and
$\G' \vdash \A' \simeq \B'$ with underlying $\f$ from $\B'$ to $\A'$.
So, $\isterm{\G'}{\app{\f}{\B'}{\A'}{\vv'}}$ and
by~\eqref{lbl:eq-term-path}, we get $\isterm{\G'}{\uu'}{\A'}$ and
$\G' \vdash \uu' \simeq \app{\f}{\B'}{\A'}{\vv'} : \A'$.
So $\isterm{\G'}{\app{\f^{-1}}{\A'}{\B'}{\uu'}}{\B'}$
and $\G' \vdash \app{\f^{-1}}{\A'}{\B'}{\uu'} \simeq \vv' : \B'$.


\Case{eq-ctx-conv}

\begin{equation*}
  \infer
  {\eqterm{\G}{\uu}{\vv}{\A}\\
    \eqctx{\G}{\D}}
  {\eqterm{\D}{\uu}{\vv}{\A}}
\end{equation*}
%
\eqref{lbl:eq-term-path}:
Assume $\D'$ and $\A'$ and $\vv'$.
By~\eqref{lbl:eq-ctx-path}, $\isctx{\G'}$ and $\G' \simeq \D'$ witnessed
by $\issubst{\theta}{\G'}{\D'}$.
Thus $\isterm{\G'}{\subst{\vv'}{\theta}}{\subst{\A'}{\theta}}$.
So by~\eqref{lbl:eq-term-path}, we have
$\isterm{\G'}{\uu'}{\subst{\A'}{\theta}}$
and $\G' \vdash \uu' \simeq \subst{\vv'}{\theta} : \subst{\A'}{\theta}$.
We thus deduce $\isterm{\D'}{\subst{\uu'}{\theta^{-1}}}{\A'}$ and
$\D' \vdash \subst{\uu'}{\theta^{-1}} \simeq \vv' : \A'$.


\Case{eq-refl}

\begin{equation*}
  \infer
  {\isterm{\G}{\uu}{\A}}
  {\eqterm{\G}{\uu}{\uu}{\A}}
\end{equation*}
%
\eqref{lbl:eq-term-path}:
Assume $\G'$ and $\uu'$ and $\A'$.
We simply return $\uu'$ and the identity path.


\Case{eq-sym}

\begin{equation*}
  \infer
  {\eqterm{\G}{\vv}{\uu}{\A}}
  {\eqterm{\G}{\uu}{\vv}{\A}}
\end{equation*}
%
\eqref{lbl:eq-term-path} directly follows from its mirrored counterpart.


\Case{eq-trans}

\begin{equation*}
  \infer
  {\eqterm{\G}{\uu}{\vv}{\A}\\
   \eqterm{\G}{\vv}{\ww}{\A}}
  {\eqterm{\G}{\uu}{\ww}{\A}}
\end{equation*}
%
\eqref{lbl:eq-term-path} works exactly like $\rl{eq-ty-trans}$.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
